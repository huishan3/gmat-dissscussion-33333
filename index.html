<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>營隊組織風險評估 (AI Powered)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Markdown Parser for AI response -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
/* 基礎設定 */
* { box-sizing: border-box; }
body {
  background-color: #000;
  color: #fff;
  font-family: 'Noto Sans TC', sans-serif;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 40px;
  padding: 40px 0;
}

/* 投影片容器 */
.slide {
  width: 1000px;
  height: 600px;
  background-color: #1a1a1a;
  border: 1px solid #333;
  border-radius: 12px;
  padding: 50px;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

/* 文字樣式 */
h1 { font-size: 48px; margin: 0 0 20px 0; font-weight: 900; line-height: 1.2; }
h2 { font-size: 36px; margin: 0 0 30px 0; color: #fff; border-left: 6px solid #ff4d4d; padding-left: 20px; }
h3 { font-size: 24px; margin: 0 0 10px 0; color: #ff4d4d; }
p { font-size: 20px; color: #ccc; line-height: 1.6; margin: 0 0 20px 0; }
.highlight { color: #ff4d4d; font-weight: bold; }

/* 佈局 - 封面 */
.cover-slide { text-align: left; }
.cover-slide h1 span { color: #ff4d4d; display: block; font-size: 64px; }

/* 佈局 - 三欄卡片 */
.grid-3 {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 20px;
  margin-top: 20px;
}
.card {
  background: #2a2a2a;
  padding: 30px;
  border-radius: 8px;
  text-align: center;
}
.card i { font-size: 40px; margin-bottom: 20px; color: #ff4d4d; }
.card h3 { color: #fff; margin-bottom: 15px; }
.card p { font-size: 18px; color: #aaa; }

/* 佈局 - 對比表格 */
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { text-align: left; padding: 20px; border-bottom: 1px solid #444; font-size: 20px; }
th { color: #ff4d4d; font-size: 22px; width: 30%; }

/* 圖表區塊 */
.chart-box {
  background: #111;
  width: 100%;
  height: 350px;
  border-radius: 8px;
  position: relative;
  border: 1px solid #333;
  padding: 20px;
}

/* 結論大字 */
.big-statement {
  font-size: 48px;
  font-weight: 900;
  text-align: center;
  line-height: 1.4;
}
.big-statement span { color: #ff4d4d; }

/* =========================================
   AI 助手區塊樣式
   ========================================= */
.ai-section {
    display: flex;
    flex-direction: column;
    height: 100%;
    gap: 15px;
}

.ai-controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.ai-btn {
    background: linear-gradient(135deg, #2b5876, #4e4376);
    border: 1px solid #666;
    color: white;
    padding: 10px 20px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.ai-btn:hover {
    filter: brightness(1.2);
    transform: translateY(-2px);
}

.ai-btn i {
    color: #ffd700; /* Gold for sparkle */
}

.ai-display {
    flex: 1;
    background: #0d1117;
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 20px;
    overflow-y: auto;
    font-size: 16px;
    color: #c9d1d9;
    font-family: 'Noto Sans TC', monospace;
    line-height: 1.6;
}

/* Scrollbar for AI display */
.ai-display::-webkit-scrollbar { width: 8px; }
.ai-display::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

.ai-input-group {
    display: flex;
    gap: 10px;
}

.ai-input {
    flex: 1;
    background: #161b22;
    border: 1px solid #30363d;
    color: #fff;
    padding: 12px;
    border-radius: 8px;
    font-size: 16px;
}

.ai-submit {
    background: #238636;
    border: none;
    color: #fff;
    padding: 0 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}
.ai-submit:disabled {
    background: #333;
    cursor: not-allowed;
}

.loading {
    display: inline-block;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 0.3; }
    50% { opacity: 1; }
    100% { opacity: 0.3; }
}

/* Markdown Styles in AI Display */
.ai-display h1, .ai-display h2, .ai-display h3 { margin-top: 10px; color: #fff; font-size: 1.2em; border: none; padding: 0; }
.ai-display ul { padding-left: 20px; }
.ai-display strong { color: #ff4d4d; }

    </style>
</head>
<body>

<!-- 封面 -->
<div class="slide cover-slide">
    <p style="color: #888; font-size: 16px;">內部評估報告</p>
    <h1>組織風險評估與<br><span>職務調整建議</span></h1>
    <p style="margin-top: 40px; font-size: 24px; color: #eee;">為了營隊的生存與下學期的招生，<br>我們必須做出改變。</p>
</div>

<!-- 我們的共識 -->
<div class="slide">
    <h2>我們在意的目標</h2>
    <div style="display: flex; gap: 40px; align-items: center; height: 100%;">
        <div style="flex: 1;">
            <p style="font-size: 24px;">不管誰當團長，<br>都不能違反這三件事：</p>
        </div>
        <div style="flex: 2; display: flex; flex-direction: column; gap: 20px;">
            <div style="background: #2a2a2a; padding: 20px; border-left: 4px solid #4caf50;">
                <h3 style="color: #4caf50; margin:0;">1. 口碑要好</h3>
                <p style="margin:0; font-size: 18px;">不能有負評傳回學校。</p>
            </div>
            <div style="background: #2a2a2a; padding: 20px; border-left: 4px solid #4caf50;">
                <h3 style="color: #4caf50; margin:0;">2. 招生要順</h3>
                <p style="margin:0; font-size: 18px;">確保下學期還招得到人。</p>
            </div>
            <div style="background: #2a2a2a; padding: 20px; border-left: 4px solid #4caf50;">
                <h3 style="color: #4caf50; margin:0;">3. 內部要穩</h3>
                <p style="margin:0; font-size: 18px;">顧問不用一直跳下來擦屁股。</p>
            </div>
        </div>
    </div>
</div>

<!-- 三大罪狀 -->
<div class="slide">
    <h2>現況：團長做了什麼？</h2>
    <div class="grid-3">
        <div class="card">
            <i class="fa-solid fa-fire"></i>
            <h3>情緒失控</h3>
            <p>針對組員人身攻擊、針對性發言。把大家都嚇跑了。</p>
        </div>
        <div class="card">
            <i class="fa-solid fa-face-dizzy"></i>
            <h3>說謊分裂</h3>
            <p>對顧問、組員講不同版本的話。製造內部對立與猜疑。</p>
        </div>
        <div class="card">
            <i class="fa-solid fa-user-xmark"></i>
            <h3>有名無實</h3>
            <p>對顧問態度差，事情都丟給組長做。有他沒他根本沒差。</p>
        </div>
    </div>
</div>

<!-- 簡單的邏輯推演 -->
<div class="slide">
    <h2>為什麼必須處理？</h2>
    <table>
        <tr>
            <th>他是「情緒亂源」</th>
            <td>留著他，組員覺得不安全，團隊氣氛隨時會爆。</td>
        </tr>
        <tr>
            <th>他是「信任殺手」</th>
            <td>說謊導致大家互不信任，以後誰要聽指揮？</td>
        </tr>
        <tr>
            <th>結論</th>
            <td><strong style="color: #ff4d4d; font-size: 24px;">他現在是負資產，不是幫手。</strong></td>
        </tr>
    </table>
    <p style="margin-top: 40px; text-align: center; color: #aaa;">如果不處理，這些問題會直接衝擊期末成發與下學期招生。</p>
</div>

<!-- 圖表：兩條路 -->
<div class="slide">
    <h2>未來預測：兩條路怎麼走？</h2>
    <div class="chart-box">
        <!-- SVG 中文圖表 -->
        <svg viewBox="0 0 800 300" style="width: 100%; height: 100%;">
            <!-- 座標軸 -->
            <line x1="50" y1="250" x2="750" y2="250" stroke="#666" stroke-width="2" />
            <line x1="50" y1="20" x2="50" y2="250" stroke="#666" stroke-width="2" />
            
            <!-- 軸標籤 -->
            <text x="700" y="280" fill="#aaa" font-size="16">時間 (學期末)</text>
            <text x="20" y="20" fill="#aaa" font-size="16" writing-mode="tb">團隊狀況 / 招生運勢</text>

            <!-- 綠線 (換人) -->
            <path d="M50,150 Q200,150 400,100 T750,50" fill="none" stroke="#4caf50" stroke-width="5" />
            <circle cx="750" cy="50" r="6" fill="#4caf50" />
            <text x="760" y="55" fill="#4caf50" font-size="20" font-weight="bold">換人：止跌回升 (招生順利)</text>

            <!-- 紅線 (不換) -->
            <path d="M50,150 Q200,180 400,220 T750,280" fill="none" stroke="#ff4d4d" stroke-width="5" stroke-dasharray="10,5" />
            <circle cx="750" cy="280" r="6" fill="#ff4d4d" />
            <text x="760" y="285" fill="#ff4d4d" font-size="20" font-weight="bold">不換：持續爛掉 (招生困難)</text>
            
            <!-- 現在點 -->
            <circle cx="50" cy="150" r="8" fill="#fff" />
            <text x="40" y="140" fill="#fff" font-size="16">現在</text>
        </svg>
    </div>
</div>

<!-- 解決方案 -->
<div class="slide">
    <h2>我們建議怎麼做？</h2>
    <div style="display: flex; gap: 30px; margin-top: 30px;">
        <div style="flex: 1; background: #331111; padding: 30px; border: 2px solid #ff4d4d; border-radius: 12px;">
            <h3 style="color: #fff;">1. 調整職務</h3>
            <p style="color: #ffcccc;">請顧問出面，暫停團長職權或撤換。<br>理由：無法勝任、造成分裂。</p>
        </div>
        <div style="flex: 1; background: #113311; padding: 30px; border: 2px solid #4caf50; border-radius: 12px;">
            <h3 style="color: #fff;">2. 接班運作</h3>
            <p style="color: #ccffcc;">由副團長 + 四組組長接手。<br>現狀本來就是我們在做，無縫接軌。</p>
        </div>
    </div>
    <p style="margin-top: 40px; text-align: center;">這是成本最低、風險最小的決定。</p>
</div>

<!-- New AI Slide -->
<div class="slide">
    <h2 style="border-left-color: #4d94ff; color: #4d94ff;">AI 決策執行助手</h2>
    <div class="ai-section">
        <p style="margin:0; font-size: 16px;">既然決定要處理，下一步該怎麼說？讓 AI 幫您擬稿。</p>
        
        <div class="ai-controls">
            <button class="ai-btn" onclick="askGemini('draft_interview')"><i class="fa-solid fa-wand-magic-sparkles"></i> 擬定面談劇本</button>
            <button class="ai-btn" onclick="askGemini('draft_announcement')"><i class="fa-solid fa-bullhorn"></i> 撰寫內部公告</button>
            <button class="ai-btn" onclick="askGemini('analyze_risks')"><i class="fa-solid fa-shield-halved"></i> 預判反彈風險</button>
        </div>

        <div id="ai-response-area" class="ai-display">
            <div style="color: #666; text-align: center; margin-top: 50px;">
                <i class="fa-brands fa-google" style="font-size: 40px; margin-bottom: 10px;"></i><br>
                Powered by Gemini 2.5<br>
                請選擇上方功能或在下方輸入問題...
            </div>
        </div>

        <div class="ai-input-group">
            <input type="text" id="custom-prompt" class="ai-input" placeholder="例如：如果團長拒絕卸任，我該怎麼回應？" onkeypress="handleEnter(event)">
            <button class="ai-submit" onclick="submitCustomPrompt()">發送</button>
        </div>
    </div>
</div>

<!-- 結尾 -->
<div class="slide" style="text-align: center; background: #000;">
    <div class="big-statement">
        長痛不如短痛。<br>
        為了<span>下學期</span>好，<br>
        現在就要做決定。
    </div>
</div>

<script>
    const apiKey = ""; // System will provide the key
    
    // Context about the situation (The "Truth")
    const context = `
    你是一個專業的組織管理與危機處理顧問。
    情境：一個學生營隊的幹部群正在建議撤換「現任團長」。
    
    團長的具體問題（罪狀）：
    1. 情緒失控：在組員異動時，對組員進行針對性攻擊（包含國籍、個人特徵），導致組員恐慌。
    2. 誠信問題：關於人事變動理由，對顧問與組員說法不一（說謊），造成內部信任破裂。
    3. 職務失能：長期不主持會議，對顧問態度不佳，僅剩串場功能且台風不好。
    
    目標：
    - 保護營隊口碑與下學期招生。
    - 讓團長和平卸任，由「副團長+四組組長」接手。
    - 降低組織動盪。
    `;

    const prompts = {
        'draft_interview': "請擬定一份「顧問與團長的一對一勸退面談劇本」。語氣要堅定但專業，不要流於謾罵，但要清楚指出上述三個問題點（情緒、誠信、能力），並告知為了營隊好，將調整其職務。請列出開場白、核心問題陳述、以及對方可能反駁時的應對話術。",
        'draft_announcement': "請撰寫一份「給全體組員的職務調整公告」。語氣要正面、安撫人心，不要公開處刑團長，用比較委婉的方式（例如：因應個人規劃與組織分工優化...）來說明團長職務變動，並強調後續由副團長與組長群接手，營運不會受影響。",
        'analyze_risks': "如果我們現在撤換團長，可能會面臨哪些風險？（例如：他去外面放話、部分死忠組員不滿...等）請列出3個最大風險，並分別給出應對策略。"
    };

    async function askGemini(type) {
        const userPrompt = prompts[type];
        await callLLM(userPrompt);
    }

    async function submitCustomPrompt() {
        const input = document.getElementById('custom-prompt');
        const userPrompt = input.value.trim();
        if (!userPrompt) return;
        
        input.value = '';
        await callLLM(userPrompt);
    }

    function handleEnter(e) {
        if (e.key === 'Enter') submitCustomPrompt();
    }

    async function callLLM(userQuery) {
        const display = document.getElementById('ai-response-area');
        display.innerHTML = '<div style="text-align:center; margin-top:50px;"><span class="loading">✨ AI 正在思考最佳策略...</span></div>';
        
        const fullPrompt = context + "\n\n使用者問題：" + userQuery;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: fullPrompt }]
                    }]
                })
            });

            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error.message);
            }

            const aiText = data.candidates[0].content.parts[0].text;
            
            // Render Markdown
            display.innerHTML = marked.parse(aiText);

        } catch (error) {
            console.error('Error:', error);
            display.innerHTML = `<div style="color: #ff4d4d; text-align: center;">⚠️ 發生錯誤：${error.message}</div>`;
        }
    }
</script>

</body>
</html>
